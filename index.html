<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <!-- ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: viewport Ù„Ù„Ù‡Ø§ØªÙ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Ù„Ø¹Ø¨Ø© Ù…Ø§Ø±ÙŠÙˆ - Ø§Ù„Ù‡Ø§ØªÙ</title>
    
    <!-- ğŸ”¥ Ø¥Ø¶Ø§ÙØ©: ØªØ«Ø¨ÙŠØª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: CSS Ø¯Ø§Ø®Ù„ HTML Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        
        body, html {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            font-family: 'Arial', sans-serif;
            background: #000;
            color: white;
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© ØªÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø© */
        #game-container {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: none;
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ */
        #portrait-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #FFD700;
            z-index: 9999;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        
        #portrait-warning h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            animation: rotate 2s infinite linear;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ ÙŠØ¸Ù‡Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± */
        @media (orientation: portrait) {
            #portrait-warning { display: flex; }
            #game-container { display: none !important; }
        }
        
        @media (orientation: landscape) {
            #portrait-warning { display: none; }
            #game-container { display: block; }
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #333;
            border-top: 5px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø§Ù„Ø´Ø§Ø´Ø§Øª */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            padding: 20px;
        }
        
        .screen.active {
            display: block;
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #start-screen {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .logo {
            margin-bottom: 30px;
        }
        
        .logo h1 {
            color: #FFD700;
            font-size: 2rem;
            margin-bottom: 20px;
        }
        
        #player-preview {
            width: 80px;
            height: 120px;
            background: #E74C3C;
            border-radius: 10px;
            margin: 0 auto 20px;
            border: 3px solid #FFD700;
        }
        
        .instructions {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px;
            max-width: 400px;
        }
        
        .instructions h2 {
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .instruction-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        
        .key {
            background: #2C3E50;
            padding: 5px 10px;
            border-radius: 5px;
            margin-left: 10px;
            border: 1px solid #FFD700;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            min-width: 200px;
        }
        
        #start-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        #game-screen {
            display: flex;
            flex-direction: column;
            padding: 0;
        }
        
        .game-header {
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #FFD700;
        }
        
        .game-info {
            display: flex;
            gap: 15px;
        }
        
        .info-item {
            background: rgba(255,255,255,0.1);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
        }
        
        #pause-btn {
            background: #3498db;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1rem;
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© */
        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
            background: #87CEEB;
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù‡Ø§ØªÙ */
        .mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }
        
        .control-group {
            display: flex;
            gap: 20px;
        }
        
        .control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            border: 3px solid #FFD700;
            color: white;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
        }
        
        #jump-btn {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            font-size: 1rem;
            flex-direction: column;
        }
        
        #jump-btn::before {
            content: "â¬†";
            font-size: 1.5rem;
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø´Ø§Ø´Ø§Øª Ø£Ø®Ø±Ù‰ */
        #pause-screen, #end-screen {
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .pause-content, .end-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            max-width: 400px;
            width: 90%;
        }
        
        #end-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-bar {
            height: 20px;
            background: rgba(255,255,255,0.1);
            margin: 10px 15px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #FFD700;
        }
        
        #level-progress {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-height: 600px) {
            .control-btn {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            #jump-btn {
                font-size: 0.9rem;
            }
        }
        
        @media (max-height: 500px) {
            .game-header {
                padding: 5px 10px;
            }
            
            .info-item {
                font-size: 0.8rem;
                padding: 4px 8px;
            }
            
            .control-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- ğŸ”¥ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ -->
    <div id="portrait-warning">
        <h1>â†»</h1>
        <p style="font-size: 1.5rem; margin: 10px 0;">Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù…Ù„ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ ÙÙ‚Ø·</p>
        <p style="font-size: 1.2rem;">ÙŠØ±Ø¬Ù‰ ØªØ¯ÙˆÙŠØ± Ù‡Ø§ØªÙÙƒ</p>
    </div>

    <!-- ğŸ”¥ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loading">
        <div class="spinner"></div>
        <p style="margin: 10px 0; color: #FFD700;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©...</p>
        <p id="loading-progress" style="font-size: 1.2rem; color: #2ecc71;">0%</p>
    </div>

    <!-- ğŸ”¥ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="game-container">
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div id="start-screen" class="screen active">
            <div class="logo">
                <h1>ğŸ® Ù„Ø¹Ø¨Ø© Ù…Ø§Ø±ÙŠÙˆ</h1>
                <div id="player-preview"></div>
                <p>Ø´Ø®ØµÙŠØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©</p>
            </div>
            
            <div class="instructions">
                <h2>ğŸ¯ ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨</h2>
                <div class="instruction-item">
                    <span class="key">â† â†’</span>
                    <span>Ø­Ø±ÙƒØ© ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø±</span>
                </div>
                <div class="instruction-item">
                    <span class="key">SPACE</span>
                    <span>Ø²Ø± Ø§Ù„Ù‚ÙØ²</span>
                </div>
                <div class="instruction-item">
                    <span class="key">ğŸŸ¡</span>
                    <span>Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</span>
                </div>
            </div>
            
            <div class="buttons">
                <button id="start-btn">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
                <button id="help-btn">â“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
            </div>
            
            <div style="margin-top: 20px; color: #aaa; font-size: 0.9rem;">
                ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù‡Ø§ØªÙ Ø£ÙÙ‚ÙŠÙ‹Ø§ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø©
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <div class="game-info">
                    <div class="info-item">â± <span id="timer">02:00</span></div>
                    <div class="info-item">â­ <span id="score">0</span></div>
                    <div class="info-item">â¤ï¸ <span id="lives">3</span></div>
                    <div class="info-item">ğŸ¯ <span id="level">1</span></div>
                </div>
                <button id="pause-btn">â¸</button>
            </div>
            
            <div class="game-area">
                <canvas id="game-canvas"></canvas>
                
                <!-- ğŸ”¥ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
                <div class="mobile-controls">
                    <div class="control-group">
                        <button id="left-btn" class="control-btn">â†</button>
                        <button id="right-btn" class="control-btn">â†’</button>
                    </div>
                    <div class="control-group">
                        <button id="jump-btn" class="control-btn">Ù‚ÙØ²</button>
                    </div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div id="level-progress"></div>
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù -->
        <div id="pause-screen" class="screen">
            <div class="pause-content">
                <h2 style="color: #FFD700; margin-bottom: 20px;">â¸ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØªÙˆÙ‚ÙØ©</h2>
                <div style="margin: 20px 0;">
                    <p>Ø§Ù„Ù†ØªÙŠØ¬Ø©: <span id="pause-score" style="color: #2ecc71;">0</span></p>
                    <p>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="pause-time" style="color: #3498db;">02:00</span></p>
                </div>
                <div class="buttons">
                    <button id="resume-btn">â–¶ Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
                    <button id="restart-pause-btn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©</button>
                    <button id="quit-btn" style="background: #e74c3c;">ğŸ  Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
        <div id="end-screen" class="screen">
            <div class="end-content">
                <div id="end-icon" style="font-size: 3rem;">ğŸ†</div>
                <h2 id="end-title" style="color: #FFD700;">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h2>
                <p id="end-message" style="margin: 10px 0;">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p>
                
                <div style="margin: 20px 0;">
                    <p>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="end-score" style="color: #2ecc71;">0</span></p>
                    <p>Ø§Ù„Ø¹Ù…Ù„Ø§Øª: <span id="end-coins" style="color: #FFD700;">0/10</span></p>
                    <p>Ø§Ù„ÙˆÙ‚Øª: <span id="end-time" style="color: #3498db;">00:00</span></p>
                </div>
                
                <div class="buttons">
                    <button id="play-again-btn">ğŸ”„ Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</button>
                    <button id="menu-btn">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”¥ Ù…Ù„Ù JavaScript -->
    <script>
        // ============================================
        // ğŸ® GAME ENGINE - Ø¥ØµØ¯Ø§Ø± Ù…Ø¨Ø³Ø· ÙŠØ¹Ù…Ù„ ÙÙˆØ±Ø§Ù‹
        // ============================================
        
        console.log('ğŸ® Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©...');
        
        class SimpleGame {
            constructor() {
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                
                // ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø­Ø¬Ù… Ø§Ù„ÙƒÙ†ÙØ§Ø³
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.resizeCanvas(), 100);
                });
                
                // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
                this.gameState = 'start'; // start, playing, paused, ended
                this.keys = {};
                this.touchControls = { left: false, right: false, jump: false };
                
                // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                this.score = 0;
                this.lives = 3;
                this.time = 120;
                this.coins = 0;
                this.totalCoins = 10;
                this.level = 1;
                
                // Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.player = {
                    x: 100,
                    y: 300,
                    width: 40,
                    height: 60,
                    speed: 5,
                    velX: 0,
                    velY: 0,
                    jumpPower: -15,
                    grounded: false,
                    facingRight: true
                };
                
                // ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.playerImg = new Image();
                this.playerImg.src = 'assets/player.png';
                this.playerImg.onerror = () => {
                    console.log('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø³Ù… Ø¨Ø¯ÙŠÙ„');
                };
                
                // Ø§Ù„Ø¹Ø§Ù„Ù…
                this.platforms = [];
                this.coinItems = [];
                this.enemies = [];
                this.createWorld();
                
                // ğŸ”¥ Ø§Ù„ØªØ­ÙƒÙ…
                this.setupControls();
                this.setupButtons();
                
                // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
                this.updateUI();
                this.hideLoading();
            }
            
            // ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø­Ø¬Ù… Ø§Ù„ÙƒÙ†ÙØ§Ø³ ÙŠÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø©
            resizeCanvas() {
                const container = document.querySelector('.game-area');
                if (container) {
                    this.canvas.width = container.clientWidth;
                    this.canvas.height = container.clientHeight;
                } else {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight * 0.8;
                }
                console.log(`ğŸ“ Ø­Ø¬Ù… Ø§Ù„ÙƒÙ†ÙØ§Ø³: ${this.canvas.width}x${this.canvas.height}`);
                this.createWorld(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù„Ù… Ø¨Ø­Ø¬Ù… Ø¬Ø¯ÙŠØ¯
            }
            
            createWorld() {
                // Ø§Ù„Ø£Ø±Ø¶
                this.platforms = [
                    { x: 0, y: this.canvas.height - 50, width: this.canvas.width * 2, height: 50 }
                ];
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØµØ§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                for (let i = 0; i < 5; i++) {
                    this.platforms.push({
                        x: 300 + i * 250,
                        y: 300 + Math.sin(i) * 50,
                        width: 150,
                        height: 20
                    });
                }
                
                // Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                this.coinItems = [];
                for (let i = 0; i < this.totalCoins; i++) {
                    this.coinItems.push({
                        x: 200 + i * 120,
                        y: 200 + Math.sin(i * 0.5) * 80,
                        collected: false,
                        anim: 0
                    });
                }
                
                // Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
                this.enemies = [
                    { x: 400, y: this.platforms[0].y - 40, width: 40, height: 40, dir: 1, speed: 2 },
                    { x: 800, y: this.platforms[0].y - 40, width: 40, height: 40, dir: -1, speed: 2.5 }
                ];
            }
            
            // ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³
            setupControls() {
                // Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
                window.addEventListener('keydown', (e) => {
                    this.keys[e.key.toLowerCase()] = true;
                    if (e.key === ' ') this.jump();
                });
                
                window.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });
                
                // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„Ù…Ø³
                const setupButton = (id, control) => {
                    const btn = document.getElementById(id);
                    if (!btn) return;
                    
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        this.touchControls[control] = true;
                        if (control === 'jump') this.jump();
                    });
                    
                    btn.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        this.touchControls[control] = false;
                    });
                    
                    btn.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        this.touchControls[control] = true;
                        if (control === 'jump') this.jump();
                    });
                    
                    btn.addEventListener('mouseup', (e) => {
                        e.preventDefault();
                        this.touchControls[control] = false;
                    });
                };
                
                setupButton('left-btn', 'left');
                setupButton('right-btn', 'right');
                setupButton('jump-btn', 'jump');
            }
            
            setupButtons() {
                // Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡
                document.getElementById('start-btn')?.addEventListener('click', () => {
                    this.startGame();
                });
                
                // Ø²Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
                document.getElementById('pause-btn')?.addEventListener('click', () => {
                    this.pauseGame();
                });
                
                // Ø²Ø± Ø§Ù„Ø§Ø³ØªØ¦Ù†Ø§Ù
                document.getElementById('resume-btn')?.addEventListener('click', () => {
                    this.resumeGame();
                });
                
                // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨
                document.getElementById('restart-pause-btn')?.addEventListener('click', () => {
                    this.restartGame();
                });
                
                document.getElementById('play-again-btn')?.addEventListener('click', () => {
                    this.restartGame();
                });
                
                // Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
                document.getElementById('quit-btn')?.addEventListener('click', () => {
                    this.showScreen('start');
                });
                
                document.getElementById('menu-btn')?.addEventListener('click', () => {
                    this.showScreen('start');
                });
                
                // Ø²Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
                document.getElementById('help-btn')?.addEventListener('click', () => {
                    alert('ğŸ® Ø§Ù„ØªØ­ÙƒÙ…:\nâ† â†’ Ù„Ù„Ø­Ø±ÙƒØ©\nSPACE Ø£Ùˆ Ø²Ø± Ø§Ù„Ù‚ÙØ² Ù„Ù„Ù‚ÙØ²\n\nğŸ¯ Ø§Ù„Ù‡Ø¯Ù:\nØ§Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©');
                });
            }
            
            jump() {
                if (this.player.grounded && this.gameState === 'playing') {
                    this.player.velY = this.player.jumpPower;
                    this.player.grounded = false;
                }
            }
            
            startGame() {
                console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©');
                this.gameState = 'playing';
                this.score = 0;
                this.lives = 3;
                this.time = 120;
                this.coins = 0;
                
                this.player.x = 100;
                this.player.y = 300;
                this.player.velX = 0;
                this.player.velY = 0;
                
                this.showScreen('game');
                this.updateUI();
                this.startTimer();
                this.gameLoop();
            }
            
            pauseGame() {
                if (this.gameState !== 'playing') return;
                this.gameState = 'paused';
                clearInterval(this.timer);
                this.showScreen('pause');
                this.updatePauseUI();
            }
            
            resumeGame() {
                if (this.gameState !== 'paused') return;
                this.gameState = 'playing';
                this.showScreen('game');
                this.startTimer();
            }
            
            restartGame() {
                this.startGame();
            }
            
            showScreen(screenName) {
                // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                document.getElementById(`${screenName}-screen`)?.classList.add('active');
            }
            
            startTimer() {
                clearInterval(this.timer);
                this.timer = setInterval(() => {
                    if (this.gameState === 'playing') {
                        this.time--;
                        this.updateUI();
                        
                        if (this.time <= 0) {
                            this.gameOver(false);
                        }
                    }
                }, 1000);
            }
            
            updatePlayer() {
                if (this.gameState !== 'playing') return;
                
                // Ø§Ù„Ø­Ø±ÙƒØ©
                this.player.velX = 0;
                if (this.keys['arrowleft'] || this.keys['a'] || this.touchControls.left) {
                    this.player.velX = -this.player.speed;
                    this.player.facingRight = false;
                }
                if (this.keys['arrowright'] || this.keys['d'] || this.touchControls.right) {
                    this.player.velX = this.player.speed;
                    this.player.facingRight = true;
                }
                
                // Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©
                this.player.velY += 0.5;
                if (this.player.velY > 15) this.player.velY = 15;
                
                // Ø§Ù„Ø­Ø±ÙƒØ©
                this.player.x += this.player.velX;
                this.player.y += this.player.velY;
                
                // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©
                if (this.player.x < 0) this.player.x = 0;
                if (this.player.x + this.player.width > this.canvas.width) {
                    this.player.x = this.canvas.width - this.player.width;
                }
                
                // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„Ù…Ù†ØµØ§Øª
                this.player.grounded = false;
                
                for (const platform of this.platforms) {
                    if (this.player.x < platform.x + platform.width &&
                        this.player.x + this.player.width > platform.x &&
                        this.player.y + this.player.height > platform.y &&
                        this.player.y + this.player.height < platform.y + platform.height + this.player.velY &&
                        this.player.velY > 0) {
                        
                        this.player.y = platform.y - this.player.height;
                        this.player.velY = 0;
                        this.player.grounded = true;
                    }
                }
                
                // Ù…Ù†Ø¹ Ø§Ù„Ø³Ù‚ÙˆØ·
                if (this.player.y > this.canvas.height) {
                    this.lives--;
                    this.updateUI();
                    
                    if (this.lives <= 0) {
                        this.gameOver(false);
                    } else {
                        this.player.x = 100;
                        this.player.y = 300;
                        this.player.velY = 0;
                    }
                }
            }
            
            updateEnemies() {
                this.enemies.forEach(enemy => {
                    enemy.x += enemy.speed * enemy.dir;
                    
                    // ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙˆØ§Ù
                    if (enemy.x < 0 || enemy.x + enemy.width > this.canvas.width * 2) {
                        enemy.dir *= -1;
                    }
                    
                    // ÙØ­Øµ Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
                    if (this.player.x < enemy.x + enemy.width &&
                        this.player.x + this.player.width > enemy.x &&
                        this.player.y < enemy.y + enemy.height &&
                        this.player.y + this.player.height > enemy.y) {
                        
                        if (this.player.velY > 0 && this.player.y + this.player.height < enemy.y + enemy.height/2) {
                            // Ø§Ù„Ù‚ÙØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ùˆ
                            enemy.y = this.canvas.height + 100; // Ø¥Ø²Ø§Ù„ØªÙ‡
                            this.score += 100;
                        } else {
                            // ØªØ¶Ø±Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨
                            this.lives--;
                            this.player.x = 100;
                            this.player.y = 300;
                            
                            if (this.lives <= 0) {
                                this.gameOver(false);
                            }
                        }
                        this.updateUI();
                    }
                });
            }
            
            updateCoins() {
                this.coinItems.forEach(coin => {
                    if (!coin.collected) {
                        coin.anim += 0.1;
                        
                        // ÙØ­Øµ Ø§Ù„Ø¬Ù…Ø¹
                        const dx = this.player.x + this.player.width/2 - coin.x;
                        const dy = this.player.y + this.player.height/2 - coin.y;
                        const distance = Math.sqrt(dx*dx + dy*dy);
                        
                        if (distance < 30) {
                            coin.collected = true;
                            this.coins++;
                            this.score += 50;
                            this.updateUI();
                            this.updateProgress();
                            
                            // ÙÙˆØ² Ø¥Ø°Ø§ Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                            if (this.coins >= this.totalCoins) {
                                this.gameOver(true);
                            }
                        }
                    }
                });
            }
            
            gameLoop() {
                if (this.gameState !== 'playing') return;
                
                this.updatePlayer();
                this.updateEnemies();
                this.updateCoins();
                this.draw();
                
                requestAnimationFrame(() => this.gameLoop());
            }
            
            draw() {
                // Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø©
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Ø§Ù„Ø®Ù„ÙÙŠØ©
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, '#3498DB');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„Ù…Ù†ØµØ§Øª
                this.ctx.fillStyle = '#8B4513';
                this.platforms.forEach(platform => {
                    this.ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                    
                    // ØªÙØ§ØµÙŠÙ„
                    this.ctx.fillStyle = '#A0522D';
                    for (let i = 0; i < platform.width; i += 20) {
                        this.ctx.fillRect(platform.x + i, platform.y, 10, 5);
                    }
                    this.ctx.fillStyle = '#8B4513';
                });
                
                // Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                this.coinItems.forEach(coin => {
                    if (!coin.collected) {
                        const bounce = Math.sin(coin.anim) * 10;
                        
                        this.ctx.fillStyle = '#FFD700';
                        this.ctx.beginPath();
                        this.ctx.arc(coin.x, coin.y + bounce, 12, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        this.ctx.fillStyle = '#FFA500';
                        this.ctx.beginPath();
                        this.ctx.arc(coin.x, coin.y + bounce, 8, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                });
                
                // Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
                this.ctx.fillStyle = '#EF476F';
                this.enemies.forEach(enemy => {
                    this.ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                    
                    // Ø¹ÙŠÙˆÙ†
                    this.ctx.fillStyle = '#2C3E50';
                    this.ctx.fillRect(enemy.x + 10, enemy.y + 10, 8, 8);
                    this.ctx.fillRect(enemy.x + enemy.width - 18, enemy.y + 10, 8, 8);
                    this.ctx.fillStyle = '#EF476F';
                });
                
                // Ø§Ù„Ù„Ø§Ø¹Ø¨
                if (this.playerImg.complete && !this.playerImg.error) {
                    // Ù‚Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ ØªØ­Ø±Ùƒ Ù„Ù„ÙŠØ³Ø§Ø±
                    if (!this.player.facingRight) {
                        this.ctx.save();
                        this.ctx.scale(-1, 1);
                        this.ctx.drawImage(this.playerImg, -this.player.x - this.player.width, this.player.y, 
                                         this.player.width, this.player.height);
                        this.ctx.restore();
                    } else {
                        this.ctx.drawImage(this.playerImg, this.player.x, this.player.y, 
                                         this.player.width, this.player.height);
                    }
                } else {
                    // Ø±Ø³Ù… Ø¨Ø¯ÙŠÙ„
                    this.ctx.fillStyle = '#E74C3C';
                    this.ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);
                    
                    this.ctx.fillStyle = '#2C3E50';
                    this.ctx.fillRect(this.player.x + 10, this.player.y + 10, 20, 20);
                    
                    this.ctx.fillStyle = '#FFF';
                    this.ctx.fillRect(this.player.x + 15, this.player.y + 15, 5, 5);
                    this.ctx.fillRect(this.player.x + 25, this.player.y + 15, 5, 5);
                }
                
                // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­
                this.ctx.fillStyle = 'rgba(0,0,0,0.5)';
                this.ctx.fillRect(10, 10, 200, 60);
                this.ctx.fillStyle = '#FFF';
                this.ctx.font = '12px Arial';
                this.ctx.fillText(`Ù…ÙˆÙ‚Ø¹: (${Math.floor(this.player.x)}, ${Math.floor(this.player.y)})`, 20, 30);
                this.ctx.fillText(`Ø³Ø±Ø¹Ø©: (${this.player.velX.toFixed(1)}, ${this.player.velY.toFixed(1)})`, 20, 50);
                this.ctx.fillText(`Ù„Ù…Ø³: ${JSON.stringify(this.touchControls)}`, 20, 70);
            }
            
            gameOver(isWin) {
                this.gameState = 'ended';
                clearInterval(this.timer);
                
                // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
                document.getElementById('end-icon').textContent = isWin ? 'ğŸ†' : 'ğŸ’€';
                document.getElementById('end-title').textContent = isWin ? 'ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!' : 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©';
                document.getElementById('end-message').textContent = isWin ? 
                    `Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${this.level}!` : 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!';
                
                document.getElementById('end-score').textContent = this.score;
                document.getElementById('end-coins').textContent = `${this.coins}/${this.totalCoins}`;
                document.getElementById('end-time').textContent = this.formatTime(120 - this.time);
                
                this.showScreen('end');
            }
            
            updateUI() {
                // Ø§Ù„ÙˆÙ‚Øª
                document.getElementById('timer').textContent = this.formatTime(this.time);
                
                // Ø§Ù„Ù†ØªÙŠØ¬Ø©
                document.getElementById('score').textContent = this.score;
                
                // Ø§Ù„Ø£Ø±ÙˆØ§Ø­
                document.getElementById('lives').textContent = this.lives;
                
                // Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                document.getElementById('level').textContent = this.level;
            }
            
            updatePauseUI() {
                document.getElementById('pause-score').textContent = this.score;
                document.getElementById('pause-time').textContent = this.formatTime(this.time);
            }
            
            updateProgress() {
                const progress = (this.coins / this.totalCoins) * 100;
                document.getElementById('level-progress').style.width = `${progress}%`;
            }
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            hideLoading() {
                setTimeout(() => {
                    const loading = document.getElementById('loading');
                    if (loading) {
                        loading.style.opacity = '0';
                        setTimeout(() => {
                            loading.style.display = 'none';
                            document.getElementById('game-container').style.display = 'block';
                            
                            // ğŸ”¥ Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ Ø¥Ø°Ø§ Ù„Ø²Ù…
                            if (window.innerHeight > window.innerWidth) {
                                document.getElementById('portrait-warning').style.display = 'flex';
                            }
                        }, 500);
                    }
                }, 1000);
            }
        }
        
        // ğŸ”¥ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', () => {
            console.log('ğŸ“„ Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…Ù„Ø©');
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„
            const progressEl = document.getElementById('loading-progress');
            if (progressEl) {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 20;
                    progressEl.textContent = `${progress}%`;
                    if (progress >= 100) clearInterval(interval);
                }, 300);
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¹Ø¯ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ·
            setTimeout(() => {
                window.game = new SimpleGame();
                console.log('âœ… Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø§Ù‡Ø²Ø©!');
                
                // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
                console.log('ğŸ® Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…:');
                console.log('- Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ù‡Ù… Ø£Ùˆ A/D Ù„Ù„Ø­Ø±ÙƒØ©');
                console.log('- Ø§Ø¶ØºØ· SPACE Ø£Ùˆ Ø²Ø± Ø§Ù„Ù‚ÙØ² Ù„Ù„Ù‚ÙØ²');
                console.log('- Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©');
            }, 1500);
        });
        
        // ğŸ”¥ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ù„Ù„Ù‡Ø§ØªÙ
        function lockOrientation() {
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('landscape').catch(err => {
                    console.log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¯ÙˆØ±Ø§Ù†:', err);
                });
            }
        }
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        if (window.innerHeight > window.innerWidth) {
            setTimeout(lockOrientation, 1000);
        }
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù…
        window.addEventListener('resize', () => {
            if (window.innerHeight > window.innerWidth) {
                lockOrientation();
            }
        });
        
        // Ù…Ù†Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚
        document.addEventListener('contextmenu', (e) => e.preventDefault());
    </script>
</body>
</html>
