<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ù…Ø§Ø±ÙŠÙˆ - Ø´Ø®ØµÙŠØªÙƒ</title>
    <style>
        /* ===== Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: white;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: fixed;
        }
        
        /* ===== Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ===== */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        #start-screen h1 {
            color: #FFD700;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .character-preview {
            width: 100px;
            height: 150px;
            background: #E74C3C;
            border-radius: 10px;
            margin: 20px 0;
            border: 3px solid #FFD700;
            position: relative;
        }
        
        .character-preview::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            height: 40px;
            background: #2C3E50;
            border-radius: 5px;
        }
        
        .character-preview::after {
            content: '';
            position: absolute;
            top: 30px;
            left: 30px;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            box-shadow: 20px 0 0 white;
        }
        
        .game-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 10px;
            margin: 10px;
            cursor: pointer;
            min-width: 200px;
            transition: all 0.3s;
        }
        
        .game-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(46, 204, 113, 0.4);
        }
        
        .game-btn:active {
            transform: translateY(1px);
        }
        
        #howto-btn {
            background: #3498db;
        }
        
        /* ===== Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨ ===== */
        #game-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            background: #000;
        }
        
        .game-header {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #FFD700;
        }
        
        .stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .stat {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            min-width: 70px;
            text-align: center;
        }
        
        #game-canvas {
            flex: 1;
            width: 100%;
            background: #87CEEB;
            display: block;
        }
        
        /* ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ===== */
        .mobile-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }
        
        .left-controls {
            display: flex;
            gap: 20px;
        }
        
        .right-controls {
            display: flex;
            gap: 20px;
        }
        
        .mobile-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid #FFD700;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
        }
        
        .mobile-btn:active {
            transform: scale(0.9);
            background: #FFD700;
            color: #000;
        }
        
        #jump-btn {
            background: rgba(231, 76, 60, 0.8);
        }
        
        /* ===== Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ===== */
        #end-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .end-content {
            background: rgba(26, 26, 46, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #FFD700;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        #end-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        /* ===== Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Ù† ===== */
        #rotate-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: #FFD700;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            z-index: 9999;
        }
        
        @media (orientation: portrait) {
            #rotate-warning {
                display: flex;
            }
            #start-screen, #game-screen, #end-screen {
                display: none !important;
            }
        }
        
        /* ===== Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ===== */
        #help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #1a1a2e;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #FFD700;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-content h2 {
            color: #FFD700;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .controls-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        
        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        
        .key {
            background: #000;
            padding: 5px 10px;
            border-radius: 5px;
            border: 2px solid #FFD700;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }
        
        #close-help {
            background: #E74C3C;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Ù† -->
    <div id="rotate-warning">
        <h1 style="font-size: 3rem;">â†»</h1>
        <h2>Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù…Ù„ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ</h2>
        <p>ÙŠØ±Ø¬Ù‰ ØªØ¯ÙˆÙŠØ± Ù‡Ø§ØªÙÙƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø©</p>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
    <div id="start-screen">
        <h1>ğŸ® Ù„Ø¹Ø¨Ø© Ù…Ø§Ø±ÙŠÙˆ</h1>
        <p style="margin: 10px 0; color: #aaa; text-align: center;">
            Ù…ØºØ§Ù…Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø´Ø®ØµÙŠØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©!
        </p>
        
        <div class="character-preview"></div>
        
        <div style="margin: 20px 0; text-align: center;">
            <div style="display: flex; gap: 20px; justify-content: center; margin-bottom: 10px;">
                <div style="text-align: center;">
                    <div style="width: 40px; height: 40px; background: #FFD700; border-radius: 50%; margin: 0 auto 5px;"></div>
                    <small>Ø§Ù„Ø¹Ù…Ù„Ø§Øª</small>
                </div>
                <div style="text-align: center;">
                    <div style="width: 40px; height: 40px; background: #E74C3C; border-radius: 50%; margin: 0 auto 5px;"></div>
                    <small>Ø§Ù„Ø¹Ø¯Ùˆ</small>
                </div>
                <div style="text-align: center;">
                    <div style="width: 40px; height: 40px; background: #2ecc71; border-radius: 50%; margin: 0 auto 5px;"></div>
                    <small>Ø§Ù„ÙØ·Ø±</small>
                </div>
            </div>
        </div>
        
        <div style="margin: 30px 0;">
            <button id="start-btn" class="game-btn">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
            <button id="howto-btn" class="game-btn">â“ ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨</button>
        </div>
        
        <p style="color: #777; font-size: 0.9rem; text-align: center; margin-top: 20px;">
            Ø§Ù„ÙˆÙ‚Øª: 2 Ø¯Ù‚ÙŠÙ‚Ø© | Ø§Ù„Ø£Ø±ÙˆØ§Ø­: 3 | Ø§Ù„Ø¹Ù…Ù„Ø§Øª: 10
        </p>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
    <div id="game-screen">
        <div class="game-header">
            <div class="stats">
                <div class="stat">â± <span id="timer">02:00</span></div>
                <div class="stat">â­ <span id="score">0</span></div>
                <div class="stat">â¤ï¸ <span id="lives">3</span></div>
                <div class="stat">ğŸŸ¡ <span id="coins">0/10</span></div>
            </div>
            <button id="pause-btn" class="game-btn" style="padding: 8px 15px; font-size: 1rem;">â¸ Ø¥ÙŠÙ‚Ø§Ù</button>
        </div>
        
        <canvas id="game-canvas"></canvas>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="mobile-controls">
            <div class="left-controls">
                <button id="left-btn" class="mobile-btn">â†</button>
                <button id="right-btn" class="mobile-btn">â†’</button>
            </div>
            <div class="right-controls">
                <button id="jump-btn" class="mobile-btn">â¬†</button>
            </div>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
    <div id="end-screen">
        <div class="end-content">
            <div id="end-icon">ğŸ†</div>
            <h2 id="end-title">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h2>
            <p id="end-message" style="margin: 15px 0;">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!</p>
            
            <div style="margin: 20px 0;">
                <p style="margin: 10px 0;">Ø§Ù„Ù†ØªÙŠØ¬Ø©: <span id="final-score" style="color: #2ecc71; font-size: 1.5rem;">0</span></p>
                <p style="margin: 10px 0;">Ø§Ù„Ø¹Ù…Ù„Ø§Øª: <span id="final-coins" style="color: #FFD700; font-size: 1.5rem;">0/10</span></p>
                <p style="margin: 10px 0;">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="final-time" style="color: #3498db; font-size: 1.5rem;">00:00</span></p>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button id="play-again-btn" class="game-btn">ğŸ”„ Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</button>
                <button id="back-to-menu-btn" class="game-btn" style="background: #3498db;">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª -->
    <div id="help-modal">
        <div class="modal-content">
            <h2><i class="fas fa-question-circle"></i> ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨</h2>
            
            <h3 style="color: #FFD700; margin: 15px 0 10px;">ğŸ¯ Ù‡Ø¯Ù Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
            <p>Ø§Ø¬Ù…Ø¹ 10 Ø¹Ù…Ù„Ø§Øª Ø°Ù‡Ø¨ÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ (Ø¯Ù‚ÙŠÙ‚ØªØ§Ù†) ÙˆØªØ¬Ù†Ø¨ Ø§Ù„ÙˆÙ‚ÙˆØ¹ ÙÙŠ Ø§Ù„ÙØ®Ø§Ø® ÙˆØ§Ù„Ø£Ø¹Ø¯Ø§Ø¡.</p>
            
            <h3 style="color: #FFD700; margin: 15px 0 10px;">âŒ¨ï¸ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­</h3>
            <div class="controls-list">
                <div class="control-item">
                    <span class="key">â¬…ï¸ Ø³Ù‡Ù… ÙŠØ³Ø§Ø±</span>
                    <span>Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„ÙŠØ³Ø§Ø±</span>
                </div>
                <div class="control-item">
                    <span class="key">â¡ï¸ Ø³Ù‡Ù… ÙŠÙ…ÙŠÙ†</span>
                    <span>Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ù„ÙŠÙ…ÙŠÙ†</span>
                </div>
                <div class="control-item">
                    <span class="key">â¬†ï¸ / Ù…Ø³Ø§ÙØ©</span>
                    <span>Ø§Ù„Ù‚ÙØ²</span>
                </div>
                <div class="control-item">
                    <span class="key">P</span>
                    <span>Ø¥ÙŠÙ‚Ø§Ù/Ù…ØªØ§Ø¨Ø¹Ø©</span>
                </div>
            </div>
            
            <h3 style="color: #FFD700; margin: 15px 0 10px;">ğŸ“± Ø§Ù„ØªØ­ÙƒÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ</h3>
            <p>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©:</p>
            <div style="display: flex; justify-content: center; gap: 20px; margin: 15px 0;">
                <div style="text-align: center;">
                    <div style="width: 50px; height: 50px; background: #3498db; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 5px;">
                        â†
                    </div>
                    <span>ÙŠØ³Ø§Ø±</span>
                </div>
                <div style="text-align: center;">
                    <div style="width: 50px; height: 50px; background: #3498db; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 5px;">
                        â†’
                    </div>
                    <span>ÙŠÙ…ÙŠÙ†</span>
                </div>
                <div style="text-align: center;">
                    <div style="width: 50px; height: 50px; background: #E74C3C; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 5px;">
                        â¬†
                    </div>
                    <span>Ù‚ÙØ²</span>
                </div>
            </div>
            
            <h3 style="color: #FFD700; margin: 15px 0 10px;">â­ Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø·</h3>
            <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 5px;">
                <p>ğŸŸ¡ Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©: 100 Ù†Ù‚Ø·Ø©</p>
                <p>ğŸ„ Ø§Ù„ÙØ·Ø±: 500 Ù†Ù‚Ø·Ø© + Ù…Ù†Ø§Ø¹Ø©</p>
                <p>ğŸ‘¾ Ù‡Ø²ÙŠÙ…Ø© Ø§Ù„Ø¹Ø¯Ùˆ: 200 Ù†Ù‚Ø·Ø©</p>
            </div>
            
            <button id="close-help" class="game-btn">âœ” ÙÙ‡Ù…Øª</button>
        </div>
    </div>

    <!-- ===== Ù…Ø­Ø±Ùƒ Ø§Ù„Ù„Ø¹Ø¨Ø© ===== -->
    <script>
        // ============================================
        // ğŸ® MARIO GAME - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ 100% ÙŠØ¹Ù…Ù„
        // ============================================
        
        console.log('ğŸ® Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù„Ø¹Ø¨Ø© Ù…Ø§Ø±ÙŠÙˆ...');
        
        class MarioGame {
            constructor() {
                console.log('ğŸ”§ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©');
                
                // ğŸ”¥ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                
                // ğŸ”¥ Ø­Ø¬Ù… Ø§Ù„ÙƒÙ†ÙØ§Ø³
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // ğŸ”¥ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                this.gameState = 'start'; // start, playing, paused, ended
                this.keys = {};
                this.touchControls = {
                    left: false,
                    right: false,
                    jump: false
                };
                
                // ğŸ”¥ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                this.score = 0;
                this.lives = 3;
                this.timeLeft = 120; // 2 Ø¯Ù‚ÙŠÙ‚Ø©
                this.coins = 0;
                this.totalCoins = 10;
                this.kills = 0;
                
                // ğŸ”¥ Ø§Ù„Ù…Ø¤Ù‚ØªØ§Øª
                this.gameTimer = null;
                this.lastTime = 0;
                this.gameStartTime = 0;
                
                // ğŸ”¥ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù„Ø¹Ø¨Ø©
                this.player = null;
                this.platforms = [];
                this.coinItems = [];
                this.enemies = [];
                this.items = [];
                this.particles = [];
                this.camera = { x: 0, y: 0 };
                
                // ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ­ÙƒÙ…
                this.setupControls();
                
                console.log('âœ… Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù‡ÙŠØ£Ø© - Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ø¨');
            }
            
            resizeCanvas() {
                const gameScreen = document.getElementById('game-screen');
                if (gameScreen) {
                    this.canvas.width = gameScreen.clientWidth;
                    this.canvas.height = gameScreen.clientHeight - 100; // Ù†Ø§Ù‚Øµ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù‡ÙŠØ¯Ø±
                } else {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight * 0.8;
                }
                console.log(`ğŸ“ Ø­Ø¬Ù… Ø§Ù„ÙƒÙ†ÙØ§Ø³: ${this.canvas.width}x${this.canvas.height}`);
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù…Ù„ØŒ Ø£Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù„Ù…
                if (this.gameState === 'playing') {
                    this.createGameWorld();
                }
            }
            
            setupControls() {
                console.log('ğŸ® ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ­ÙƒÙ…...');
                
                // ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© =====
                
                // Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡
                document.getElementById('start-btn').addEventListener('click', () => {
                    console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©');
                    this.startGame();
                });
                
                // Ø²Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
                document.getElementById('howto-btn').addEventListener('click', () => {
                    document.getElementById('help-modal').style.display = 'flex';
                });
                
                // Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª
                document.getElementById('close-help').addEventListener('click', () => {
                    document.getElementById('help-modal').style.display = 'none';
                });
                
                // Ø²Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
                document.getElementById('pause-btn').addEventListener('click', () => {
                    if (this.gameState === 'playing') {
                        this.pauseGame();
                        document.getElementById('pause-btn').textContent = 'â–¶ Ø§Ø³ØªØ¦Ù†Ø§Ù';
                    } else if (this.gameState === 'paused') {
                        this.resumeGame();
                        document.getElementById('pause-btn').textContent = 'â¸ Ø¥ÙŠÙ‚Ø§Ù';
                    }
                });
                
                // Ø²Ø± Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹
                document.getElementById('play-again-btn').addEventListener('click', () => {
                    console.log('ğŸ”„ Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹');
                    this.startGame();
                });
                
                // Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                document.getElementById('back-to-menu-btn').addEventListener('click', () => {
                    this.showScreen('start');
                });
                
                // ===== Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ =====
                
                // Ø²Ø± Ø§Ù„ÙŠØ³Ø§Ø± (Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±)
                document.getElementById('left-btn').addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.touchControls.left = true;
                });
                
                document.getElementById('left-btn').addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.touchControls.left = false;
                });
                
                document.getElementById('left-btn').addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    this.touchControls.left = true;
                });
                
                document.getElementById('left-btn').addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    this.touchControls.left = false;
                });
                
                // Ø²Ø± Ø§Ù„ÙŠÙ…ÙŠÙ† (Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±)
                document.getElementById('right-btn').addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.touchControls.right = true;
                });
                
                document.getElementById('right-btn').addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.touchControls.right = false;
                });
                
                document.getElementById('right-btn').addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    this.touchControls.right = true;
                });
                
                document.getElementById('right-btn').addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    this.touchControls.right = false;
                });
                
                // Ø²Ø± Ø§Ù„Ù‚ÙØ² (Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ†)
                document.getElementById('jump-btn').addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.touchControls.jump = true;
                });
                
                document.getElementById('jump-btn').addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.touchControls.jump = false;
                });
                
                document.getElementById('jump-btn').addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    this.touchControls.jump = true;
                });
                
                document.getElementById('jump-btn').addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    this.touchControls.jump = false;
                });
                
                // ===== Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ =====
                
                window.addEventListener('keydown', (e) => {
                    const key = e.key.toLowerCase();
                    this.keys[key] = true;
                    
                    // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ±
                    if ([' ', 'arrowup', 'arrowdown', 'arrowleft', 'arrowright'].includes(key)) {
                        e.preventDefault();
                    }
                    
                    // Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
                    if (key === 'p' && this.gameState === 'playing') {
                        this.pauseGame();
                        document.getElementById('pause-btn').textContent = 'â–¶ Ø§Ø³ØªØ¦Ù†Ø§Ù';
                    } else if (key === 'p' && this.gameState === 'paused') {
                        this.resumeGame();
                        document.getElementById('pause-btn').textContent = 'â¸ Ø¥ÙŠÙ‚Ø§Ù';
                    }
                    
                    // Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ø§Ù„Ø¥Ø³ÙƒÙŠØ¨
                    if (key === 'escape' && this.gameState === 'paused') {
                        this.resumeGame();
                        document.getElementById('pause-btn').textContent = 'â¸ Ø¥ÙŠÙ‚Ø§Ù';
                    }
                });
                
                window.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });
                
                console.log('âœ… Ø§Ù„ØªØ­ÙƒÙ… Ø¬Ø§Ù‡Ø²');
            }
            
            showScreen(screenName) {
                console.log(`ğŸ“º Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø©: ${screenName}`);
                
                // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'none';
                document.getElementById('end-screen').style.display = 'none';
                document.getElementById('help-modal').style.display = 'none';
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                if (screenName === 'start') {
                    document.getElementById('start-screen').style.display = 'flex';
                    this.gameState = 'start';
                } else if (screenName === 'game') {
                    document.getElementById('game-screen').style.display = 'flex';
                } else if (screenName === 'end') {
                    document.getElementById('end-screen').style.display = 'flex';
                    this.gameState = 'ended';
                }
            }
            
            startGame() {
                console.log('ğŸ¯ ===== Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© =====');
                
                // ğŸ”¥ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ø´ÙŠØ¡
                this.gameState = 'playing';
                this.score = 0;
                this.lives = 3;
                this.timeLeft = 120;
                this.coins = 0;
                this.kills = 0;
                
                // ğŸ”¥ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù„Ù…
                this.createGameWorld();
                
                // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                this.updateUI();
                
                // ğŸ”¥ Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨
                this.showScreen('game');
                
                // ğŸ”¥ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
                this.startTimer();
                
                // ğŸ”¥ Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                this.lastTime = performance.now();
                this.gameLoop();
                
                console.log(`âœ… Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯Ø£Øª - Ø§Ù„ÙˆÙ‚Øª: ${this.timeLeft}Ø«ØŒ Ø§Ù„Ø£Ø±ÙˆØ§Ø­: ${this.lives}`);
            }
            
            createGameWorld() {
                console.log('ğŸŒ Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø§Ù„Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©...');
                
                // ğŸ”¥ Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.player = {
                    x: 100,
                    y: 300,
                    width: 40,
                    height: 60,
                    speed: 6,
                    velX: 0,
                    velY: 0,
                    jumpPower: -16,
                    grounded: false,
                    canJump: true,
                    facingRight: true,
                    invincible: false,
                    invincibleTime: 0
                };
                
                // ğŸ”¥ Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„Ù…Ù†ØµØ§Øª
                this.platforms = [
                    // Ø§Ù„Ø£Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    { x: 0, y: this.canvas.height - 50, width: this.canvas.width * 3, height: 50, type: 'ground' }
                ];
                
                // ğŸ”¥ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØµØ§Øª Ø¹Ø§Ø¦Ù…Ø©
                for (let i = 0; i < 5; i++) {
                    this.platforms.push({
                        x: 250 + i * 200,
                        y: 300 + Math.sin(i) * 70,
                        width: 150,
                        height: 20,
                        type: 'platform'
                    });
                }
                
                // ğŸ”¥ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                this.coinItems = [];
                for (let i = 0; i < this.totalCoins; i++) {
                    this.coinItems.push({
                        x: 180 + i * 160,
                        y: 180 + Math.sin(i * 0.7) * 90,
                        collected: false,
                        anim: 0,
                        id: i
                    });
                }
                
                // ğŸ”¥ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
                this.enemies = [
                    { x: 450, y: this.platforms[0].y - 40, width: 40, height: 40, dir: 1, speed: 2, active: true },
                    { x: 750, y: this.platforms[0].y - 40, width: 40, height: 40, dir: -1, speed: 2.5, active: true },
                    { x: 1050, y: this.platforms[0].y - 40, width: 40, height: 40, dir: 1, speed: 3, active: true }
                ];
                
                // ğŸ”¥ Ø§Ù„Ø¹Ù†Ø§ØµØ±
                this.items = [
                    { x: 500, y: 200, type: 'mushroom', collected: false },
                    { x: 950, y: 180, type: 'flower', collected: false }
                ];
                
                // ğŸ”¥ Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
                this.particles = [];
                
                // ğŸ”¥ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                this.camera.x = 0;
                this.camera.y = 0;
                
                console.log(`ğŸ¯ Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${this.platforms.length} Ù…Ù†ØµØ©ØŒ ${this.coinItems.length} Ø¹Ù…Ù„Ø©`);
            }
            
            startTimer() {
                console.log('â±ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª');
                
                // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø¤Ù‚Øª Ø³Ø§Ø¨Ù‚
                if (this.gameTimer) {
                    clearInterval(this.gameTimer);
                }
                
                // Ø¨Ø¯Ø¡ Ù…Ø¤Ù‚Øª Ø¬Ø¯ÙŠØ¯
                this.gameTimer = setInterval(() => {
                    if (this.gameState === 'playing') {
                        this.timeLeft--;
                        this.updateUI();
                        
                        console.log(`â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${this.timeLeft}Ø«`);
                        
                        // ÙØ­Øµ Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª
                        if (this.timeLeft <= 0) {
                            console.log('â° Ø§Ù„ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ù‰!');
                            this.endGame(false, 'time');
                        }
                    }
                }, 1000);
            }
            
            updateUI() {
                // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
                const minutes = Math.floor(this.timeLeft / 60);
                const seconds = this.timeLeft % 60;
                const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('timer').textContent = timeString;
                
                // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªÙŠØ¬Ø©
                document.getElementById('score').textContent = this.score;
                
                // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±ÙˆØ§Ø­
                document.getElementById('lives').textContent = this.lives;
                
                // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                document.getElementById('coins').textContent = `${this.coins}/${this.totalCoins}`;
            }
            
            updatePlayer(deltaTime) {
                if (this.gameState !== 'playing') return;
                
                // ğŸ”¥ Ø§Ù„Ù…Ù†Ø§Ø¹Ø©
                if (this.player.invincible) {
                    this.player.invincibleTime -= deltaTime;
                    if (this.player.invincibleTime <= 0) {
                        this.player.invincible = false;
                    }
                }
                
                // ğŸ”¥ Ø§Ù„Ø­Ø±ÙƒØ©
                this.player.velX = 0;
                
                if (this.keys['arrowleft'] || this.keys['a'] || this.touchControls.left) {
                    this.player.velX = -this.player.speed;
                    this.player.facingRight = false;
                }
                
                if (this.keys['arrowright'] || this.keys['d'] || this.touchControls.right) {
                    this.player.velX = this.player.speed;
                    this.player.facingRight = true;
                }
                
                // ğŸ”¥ Ø§Ù„Ù‚ÙØ²
                if ((this.keys[' '] || this.keys['arrowup'] || this.keys['w'] || this.touchControls.jump) && 
                    this.player.grounded && this.player.canJump) {
                    this.player.velY = this.player.jumpPower;
                    this.player.grounded = false;
                    this.player.canJump = false;
                    
                    setTimeout(() => {
                        this.player.canJump = true;
                    }, 300);
                }
                
                // ğŸ”¥ Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©
                this.player.velY += 0.8;
                if (this.player.velY > 20) this.player.velY = 20;
                
                // ğŸ”¥ Ø§Ù„Ø­Ø±ÙƒØ©
                this.player.x += this.player.velX * deltaTime * 60;
                this.player.y += this.player.velY * deltaTime * 60;
                
                // ğŸ”¥ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© (ÙŠØ³Ø§Ø±)
                if (this.player.x < 0) {
                    this.player.x = 0;
                }
                
                // ğŸ”¥ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø© (ÙŠÙ…ÙŠÙ†)
                const maxX = this.canvas.width * 3 - this.player.width;
                if (this.player.x > maxX) {
                    this.player.x = maxX;
                }
                
                // ğŸ”¥ ÙØ­Øµ Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ù…Ø¹ Ø§Ù„Ù…Ù†ØµØ§Øª
                this.player.grounded = false;
                
                for (const platform of this.platforms) {
                    const collision = 
                        this.player.x < platform.x + platform.width &&
                        this.player.x + this.player.width > platform.x &&
                        this.player.y + this.player.height > platform.y &&
                        this.player.y + this.player.height < platform.y + platform.height + this.player.velY &&
                        this.player.velY > 0;
                    
                    if (collision) {
                        this.player.y = platform.y - this.player.height;
                        this.player.velY = 0;
                        this.player.grounded = true;
                        break;
                    }
                }
                
                // ğŸ”¥ ÙØ­Øµ Ø§Ù„Ø³Ù‚ÙˆØ·
                if (this.player.y > this.canvas.height + 100) {
                    console.log('ğŸ’€ Ø³Ù‚ÙˆØ·!');
                    this.playerDamaged();
                }
            }
            
            updateEnemies(deltaTime) {
                for (let enemy of this.enemies) {
                    if (!enemy.active) continue;
                    
                    // Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
                    enemy.x += enemy.speed * enemy.dir * deltaTime * 60;
                    
                    // ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙˆØ§Ù
                    if (enemy.x < 0 || enemy.x + enemy.width > this.canvas.width * 3) {
                        enemy.dir *= -1;
                    }
                    
                    // ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶
                    enemy.y = this.platforms[0].y - enemy.height;
                }
            }
            
            updateCoins(deltaTime) {
                for (let coin of this.coinItems) {
                    if (!coin.collected) {
                        // Ø­Ø±ÙƒØ© Ø·ÙÙŠÙØ© Ù„Ù„Ø¹Ù…Ù„Ø§Øª
                        coin.anim += deltaTime * 5;
                    }
                }
            }
            
            updateItems(deltaTime) {
                for (let item of this.items) {
                    if (!item.collected) {
                        // Ø­Ø±ÙƒØ© Ø·ÙÙŠÙØ© Ù„Ù„Ø¹Ù†Ø§ØµØ±
                        item.y += Math.sin(Date.now() * 0.002) * 0.5;
                    }
                }
            }
            
            updateCamera() {
                if (!this.player) return;
                
                // Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨
                const targetX = this.player.x - this.canvas.width / 2 + this.player.width / 2;
                const targetY = this.player.y - this.canvas.height / 2 + this.player.height / 2;
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø³Ù„Ø§Ø³Ø©
                this.camera.x += (targetX - this.camera.x) * 0.1;
                this.camera.y += (targetY - this.camera.y) * 0.1;
                
                // Ø§Ù„Ø­Ø¯ÙˆØ¯
                this.camera.x = Math.max(0, Math.min(this.canvas.width * 2.5 - this.canvas.width, this.camera.x));
                this.camera.y = Math.max(0, Math.min(600 - this.canvas.height, this.camera.y));
            }
            
            checkCollisions() {
                // ğŸ”¥ Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                for (let coin of this.coinItems) {
                    if (!coin.collected) {
                        const dx = this.player.x + this.player.width/2 - coin.x;
                        const dy = this.player.y + this.player.height/2 - coin.y;
                        const distance = Math.sqrt(dx*dx + dy*dy);
                        
                        if (distance < 30) {
                            console.log(`ğŸ’° Ø¬Ù…Ø¹ Ø¹Ù…Ù„Ø© ${coin.id + 1}!`);
                            coin.collected = true;
                            this.coins++;
                            this.score += 100;
                            this.updateUI();
                            
                            // ğŸ”¥ ÙØ­Øµ Ø¥Ø°Ø§ Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                            if (this.coins >= this.totalCoins) {
                                console.log('ğŸ† Ø¬Ù…Ø¹Øª ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª!');
                                this.endGame(true, 'coins');
                            }
                        }
                    }
                }
                
                // ğŸ”¥ Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
                for (let item of this.items) {
                    if (!item.collected) {
                        const dx = this.player.x + this.player.width/2 - item.x;
                        const dy = this.player.y + this.player.height/2 - item.y;
                        const distance = Math.sqrt(dx*dx + dy*dy);
                        
                        if (distance < 40) {
                            console.log(`ğŸ Ø¬Ù…Ø¹ Ø¹Ù†ØµØ±: ${item.type}`);
                            item.collected = true;
                            
                            if (item.type === 'mushroom') {
                                this.score += 500;
                                this.player.invincible = true;
                                this.player.invincibleTime = 10;
                            } else if (item.type === 'flower') {
                                this.score += 1000;
                                this.player.speed *= 1.5;
                                this.player.invincible = true;
                                this.player.invincibleTime = 15;
                            }
                            
                            this.updateUI();
                        }
                    }
                }
                
                // ğŸ”¥ Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ø¨Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
                for (let enemy of this.enemies) {
                    if (!enemy.active) continue;
                    
                    if (this.player.x < enemy.x + enemy.width &&
                        this.player.x + this.player.width > enemy.x &&
                        this.player.y < enemy.y + enemy.height &&
                        this.player.y + this.player.height > enemy.y) {
                        
                        // Ø¥Ø°Ø§ ÙˆØ·Ø£ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ùˆ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰
                        if (this.player.velY > 0 && this.player.y + this.player.height < enemy.y + enemy.height/2) {
                            console.log('ğŸ‘¾ Ù‡Ø²Ù…Øª Ø¹Ø¯ÙˆØ§Ù‹!');
                            enemy.active = false;
                            enemy.x = -1000; // Ø¥Ø²Ø§Ù„ØªÙ‡
                            this.score += 200;
                            this.kills++;
                            this.player.velY = -12; // Ù‚ÙØ² Ø¹Ù†Ø¯ Ù‡Ø²ÙŠÙ…Ø© Ø§Ù„Ø¹Ø¯Ùˆ
                            this.updateUI();
                        } else if (!this.player.invincible) {
                            // ØªØ¶Ø±Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨
                            console.log('ğŸ’¥ ØªØ¶Ø±Ø± Ù…Ù† Ø¹Ø¯Ùˆ!');
                            this.playerDamaged();
                        }
                    }
                }
            }
            
            playerDamaged() {
                if (this.player.invincible) return;
                
                this.lives--;
                this.updateUI();
                
                if (this.lives <= 0) {
                    this.endGame(false, 'lives');
                } else {
                    // Ù…Ù†Ø§Ø¹Ø© Ù…Ø¤Ù‚ØªØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±Ø±
                    this.player.invincible = true;
                    this.player.invincibleTime = 2;
                    
                    // ØªØ£Ø«ÙŠØ± Ø§Ø±ØªØ¯Ø§Ø¯
                    this.player.velY = -10;
                    this.player.velX = this.player.facingRight ? -10 : 10;
                    
                    console.log(`ğŸ’” ØªØ¶Ø±Ø±Øª! Ø§Ù„Ø£Ø±ÙˆØ§Ø­ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${this.lives}`);
                }
            }
            
            gameLoop(currentTime = 0) {
                if (this.gameState !== 'playing') {
                    return;
                }
                
                // ğŸ”¥ Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ
                const deltaTime = (currentTime - this.lastTime) / 1000;
                this.lastTime = currentTime;
                
                // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ±
                this.updatePlayer(deltaTime);
                this.updateEnemies(deltaTime);
                this.updateCoins(deltaTime);
                this.updateItems(deltaTime);
                this.updateCamera();
                this.checkCollisions();
                
                // ğŸ”¥ Ø§Ù„Ø±Ø³Ù…
                this.draw();
                
                // ğŸ”¥ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø­Ù„Ù‚Ø©
                requestAnimationFrame((time) => this.gameLoop(time));
            }
            
            draw() {
                // ğŸ”¥ Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø©
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ØªØ·Ø¨ÙŠÙ‚ ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                this.ctx.save();
                this.ctx.translate(-this.camera.x, -this.camera.y);
                
                // ğŸ”¥ Ø§Ù„Ø®Ù„ÙÙŠØ©
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(0.7, '#5DADE2');
                gradient.addColorStop(1, '#3498DB');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width * 3, this.canvas.height);
                
                // ğŸ”¥ Ø³Ø­Ø¨ Ø¨Ø³ÙŠØ·Ø©
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                for (let i = 0; i < 3; i++) {
                    const x = (this.camera.x * 0.3 + i * 200) % (this.canvas.width * 3 + 200);
                    this.ctx.beginPath();
                    this.ctx.arc(x, 50, 30, 0, Math.PI * 2);
                    this.ctx.arc(x + 40, 50, 40, 0, Math.PI * 2);
                    this.ctx.arc(x + 90, 50, 30, 0, Math.PI * 2);
                    this.ctx.fill();
                }
                
                // ğŸ”¥ Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„Ù…Ù†ØµØ§Øª
                this.platforms.forEach(platform => {
                    this.ctx.fillStyle = platform.type === 'ground' ? '#8B4513' : '#A0522D';
                    this.ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                    
                    // ØªÙØ§ØµÙŠÙ„
                    this.ctx.fillStyle = platform.type === 'ground' ? '#A0522D' : '#8B4513';
                    for (let i = 0; i < platform.width; i += 20) {
                        this.ctx.fillRect(platform.x + i, platform.y, 10, 5);
                    }
                });
                
                // ğŸ”¥ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                this.coinItems.forEach(coin => {
                    if (!coin.collected) {
                        const bounce = Math.sin(coin.anim) * 10;
                        
                        this.ctx.fillStyle = '#FFD700';
                        this.ctx.beginPath();
                        this.ctx.arc(coin.x, coin.y + bounce, 12, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        this.ctx.fillStyle = '#FFA500';
                        this.ctx.beginPath();
                        this.ctx.arc(coin.x, coin.y + bounce, 8, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        // Ø¨Ø±ÙŠÙ‚
                        this.ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                        this.ctx.beginPath();
                        this.ctx.arc(coin.x - 3, coin.y - 3 + bounce, 3, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                });
                
                // ğŸ”¥ Ø§Ù„Ø¹Ù†Ø§ØµØ±
                this.items.forEach(item => {
                    if (!item.collected) {
                        if (item.type === 'mushroom') {
                            // ÙØ·Ø±
                            this.ctx.fillStyle = '#E74C3C';
                            this.ctx.beginPath();
                            this.ctx.arc(item.x, item.y, 20, 0, Math.PI * 2);
                            this.ctx.fill();
                            
                            this.ctx.fillStyle = '#FFF';
                            this.ctx.beginPath();
                            this.ctx.arc(item.x - 5, item.y - 5, 6, 0, Math.PI * 2);
                            this.ctx.arc(item.x + 5, item.y - 5, 6, 0, Math.PI * 2);
                            this.ctx.fill();
                        } else if (item.type === 'flower') {
                            // Ø²Ù‡Ø±Ø©
                            this.ctx.fillStyle = '#9B59B6';
                            this.ctx.save();
                            this.ctx.translate(item.x, item.y);
                            for (let i = 0; i < 8; i++) {
                                this.ctx.rotate(Math.PI / 4);
                                this.ctx.fillRect(0, -10, 20, 10);
                            }
                            this.ctx.restore();
                        }
                    }
                });
                
                // ğŸ”¥ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
                this.enemies.forEach(enemy => {
                    if (!enemy.active) return;
                    
                    this.ctx.fillStyle = '#EF476F';
                    this.ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                    
                    // Ø¹ÙŠÙˆÙ†
                    this.ctx.fillStyle = '#2C3E50';
                    this.ctx.fillRect(enemy.x + 10, enemy.y + 10, 8, 8);
                    this.ctx.fillRect(enemy.x + enemy.width - 18, enemy.y + 10, 8, 8);
                    
                    // ÙÙ…
                    this.ctx.fillRect(enemy.x + 15, enemy.y + 30, enemy.width - 30, 5);
                });
                
                // ğŸ”¥ Ø§Ù„Ù„Ø§Ø¹Ø¨
                // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù…Ù†Ø§Ø¹Ø© (ÙˆÙ…ÙŠØ¶)
                if (this.player.invincible && Math.floor(this.player.invincibleTime * 10) % 2 === 0) {
                    this.ctx.globalAlpha = 0.5;
                }
                
                this.ctx.fillStyle = '#E74C3C';
                this.ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);
                
                // ÙˆØ¬Ù‡ Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.ctx.fillStyle = '#2C3E50';
                this.ctx.fillRect(this.player.x + 10, this.player.y + 10, 20, 20);
                
                // Ø¹ÙŠÙˆÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.ctx.fillStyle = '#FFF';
                const eyeOffset = this.player.grounded ? 0 : 2;
                this.ctx.fillRect(this.player.x + 15, this.player.y + 15 + eyeOffset, 5, 5);
                this.ctx.fillRect(this.player.x + 25, this.player.y + 15 + eyeOffset, 5, 5);
                
                this.ctx.globalAlpha = 1;
                
                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
                this.ctx.restore();
            }
            
            pauseGame() {
                console.log('â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©');
                this.gameState = 'paused';
                clearInterval(this.gameTimer);
            }
            
            resumeGame() {
                console.log('â–¶ï¸ Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©');
                this.gameState = 'playing';
                this.startTimer();
                this.lastTime = performance.now();
                this.gameLoop();
            }
            
            endGame(isWin, reason = '') {
                console.log(`ğŸ® Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© - ÙÙˆØ²: ${isWin}, Ø§Ù„Ø³Ø¨Ø¨: ${reason}`);
                
                // ğŸ”¥ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª ÙˆØ§Ù„Ø­Ù„Ù‚Ø©
                this.gameState = 'ended';
                clearInterval(this.gameTimer);
                
                // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
                document.getElementById('end-icon').textContent = isWin ? 'ğŸ†' : 'ğŸ’€';
                document.getElementById('end-title').textContent = isWin ? 'ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!' : 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©';
                
                let message = '';
                if (isWin) {
                    message = `Ø¬Ù…Ø¹Øª ${this.coins} Ø¹Ù…Ù„Ø© ÙÙŠ ${this.formatTime(120 - this.timeLeft)}!`;
                } else {
                    switch(reason) {
                        case 'time':
                            message = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!';
                            break;
                        case 'lives':
                            message = 'Ù†ÙØ°Øª Ø§Ù„Ø£Ø±ÙˆØ§Ø­!';
                            break;
                        case 'coins':
                            message = 'Ø¬Ù…Ø¹Øª ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª!';
                            break;
                        default:
                            message = 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!';
                    }
                }
                document.getElementById('end-message').textContent = message;
                
                document.getElementById('final-score').textContent = this.score;
                document.getElementById('final-coins').textContent = `${this.coins}/${this.totalCoins}`;
                document.getElementById('final-time').textContent = this.formatTime(120 - this.timeLeft);
                
                // ğŸ”¥ Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
                this.showScreen('end');
                
                console.log(`ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${this.score} Ù†Ù‚Ø·Ø©ØŒ ${this.coins}/${this.totalCoins} Ø¹Ù…Ù„Ø©`);
            }
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
        }
        
        // ============================================
        // ğŸ”¥ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        // ============================================
        
        let game;
        
        window.addEventListener('load', () => {
            console.log('ğŸ“„ Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…Ù„Ø© - Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©...');
            
            // ğŸ”¥ Ø¥Ø®ÙØ§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£ÙÙ‚ÙŠ
            if (window.innerHeight <= window.innerWidth) {
                document.getElementById('rotate-warning').style.display = 'none';
            }
            
            // ğŸ”¥ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
            game = new MarioGame();
            console.log('âœ… Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø§Ù‡Ø²Ø©! Ø§Ø¶ØºØ· Ø²Ø± "ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨"');
            
            // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù…
            window.addEventListener('resize', () => {
                const warning = document.getElementById('rotate-warning');
                if (window.innerHeight > window.innerWidth) {
                    warning.style.display = 'flex';
                    document.getElementById('start-screen').style.display = 'none';
                    document.getElementById('game-screen').style.display = 'none';
                    document.getElementById('end-screen').style.display = 'none';
                } else {
                    warning.style.display = 'none';
                    document.getElementById('start-screen').style.display = 'flex';
                }
            });
        });
        
        // ğŸ”¥ Ù…Ù†Ø¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ù‚
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        console.log('ğŸ® ÙƒÙˆØ¯ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø­Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
    </script>
</body>
</html>
