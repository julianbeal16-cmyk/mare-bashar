<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <!-- ğŸ”¥ Ø¥ØµÙ„Ø§Ø­ Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Ù„Ø¹Ø¨Ø© Ù…Ø§Ø±ÙŠÙˆ - Ø§Ù„Ù‡Ø§ØªÙ</title>
    
    <style>
        /* ğŸ”¥ CSS Ø¯Ø§Ø®Ù„ HTML Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
        }
        
        body, html {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            font-family: 'Arial', sans-serif;
            background: #000;
            color: white;
        }
        
        /* ğŸ”¥ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙˆØ±Ø§Ù† */
        #rotate-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            color: #FFD700;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        
        #rotate-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: rotate 2s infinite linear;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ğŸ”¥ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 9998;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 5px solid #333;
            border-top: 5px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        /* ğŸ”¥ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© */
        #game-container {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            overflow: hidden;
            display: none;
        }
        
        /* ğŸ”¥ Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© */
        #fullscreen-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 45px;
            height: 45px;
            background: rgba(0,0,0,0.7);
            border: 2px solid #FFD700;
            color: #FFD700;
            border-radius: 50%;
            font-size: 1.2rem;
            z-index: 1000;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        #fullscreen-btn:hover {
            background: #FFD700;
            color: #000;
        }
        
        /* ğŸ”¥ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .screen.active {
            display: flex;
        }
        
        /* ğŸ”¥ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #start-screen {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            text-align: center;
        }
        
        .logo {
            margin-bottom: 30px;
        }
        
        .logo h1 {
            color: #FFD700;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .character-box {
            width: 120px;
            height: 160px;
            margin: 0 auto 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            border: 3px solid #FFD700;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        #player-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .game-info {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 10px;
            margin: 20px;
            max-width: 400px;
        }
        
        .controls-guide {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }
        
        .control-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        
        .control-key {
            background: #2C3E50;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #FFD700;
            min-width: 60px;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
            width: 90%;
            max-width: 300px;
        }
        
        .game-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .game-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .game-btn:active {
            transform: translateY(0);
        }
        
        #start-game-btn {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }
        
        /* ğŸ”¥ Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        #game-screen {
            background: #000;
            padding: 0;
            align-items: stretch;
        }
        
        .game-header {
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #FFD700;
            flex-shrink: 0;
        }
        
        .stats {
            display: flex;
            gap: 15px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
            background: #000;
        }
        
        /* ğŸ”¥ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù‡Ø§ØªÙ */
        .touch-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
            pointer-events: none;
        }
        
        .touch-controls > div {
            pointer-events: auto;
        }
        
        .dpad {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .dpad-row {
            display: flex;
            gap: 5px;
        }
        
        .touch-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            border: 3px solid #FFD700;
            color: white;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
        }
        
        #jump-touch-btn {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
            width: 80px;
            height: 80px;
            font-size: 1.2rem;
            flex-direction: column;
        }
        
        #jump-touch-btn::before {
            content: "â¬†";
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        /* ğŸ”¥ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… */
        .progress-container {
            padding: 10px 15px;
            background: rgba(0,0,0,0.5);
            flex-shrink: 0;
        }
        
        .progress-bar {
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #FFD700;
        }
        
        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* ğŸ”¥ Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
        #end-screen {
            background: rgba(0,0,0,0.95);
        }
        
        .end-box {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 30px;
            border-radius: 20px;
            border: 4px solid #FFD700;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .end-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .end-stats {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .end-stat {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        
        /* ğŸ”¥ Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
        @media (orientation: portrait) {
            #rotate-warning { display: flex; }
            #game-container { display: none !important; }
        }
        
        @media (orientation: landscape) {
            #rotate-warning { display: none; }
        }
        
        @media (max-height: 500px) {
            .touch-btn {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            #jump-touch-btn {
                width: 70px;
                height: 70px;
            }
            
            .game-header {
                padding: 8px 12px;
            }
            
            .stat-item {
                padding: 6px 10px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-height: 400px) {
            .touch-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            #jump-touch-btn {
                width: 60px;
                height: 60px;
                font-size: 1rem;
            }
            
            #jump-touch-btn::before {
                font-size: 1.5rem;
            }
        }
        
        /* ğŸ”¥ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- ğŸ”¥ Ø´Ø§Ø´Ø© ØªØ¯ÙˆÙŠØ± Ø§Ù„Ù‡Ø§ØªÙ -->
    <div id="rotate-warning">
        <div id="rotate-icon">â†»</div>
        <h2 style="margin-bottom: 20px;">Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù…Ù„ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ</h2>
        <p style="font-size: 1.2rem;">ÙŠØ±Ø¬Ù‰ ØªØ¯ÙˆÙŠØ± Ù‡Ø§ØªÙÙƒ</p>
        <p style="margin-top: 30px; color: #aaa; font-size: 0.9rem;">
            Ø£Ùˆ ØªÙØ¹ÙŠÙ„ "ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¯ÙˆØ±Ø§Ù†" ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‡Ø§ØªÙÙƒ
        </p>
    </div>

    <!-- ğŸ”¥ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loading-screen">
        <div class="loader"></div>
        <h2 style="color: #FFD700; margin: 20px 0;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©...</h2>
        <p id="load-progress" style="color: #2ecc71; font-size: 1.5rem;">0%</p>
    </div>

    <!-- ğŸ”¥ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="game-container">
        <!-- Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© -->
        <button id="fullscreen-btn" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">â›¶</button>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
        <div id="start-screen" class="screen active">
            <div class="logo">
                <h1>ğŸ® Ù„Ø¹Ø¨Ø© Ù…Ø§Ø±ÙŠÙˆ</h1>
                <div class="character-box">
                    <img id="player-img" src="" alt="Ø´Ø®ØµÙŠØªÙƒ" onerror="this.style.display='none'">
                </div>
                <p>Ø´Ø®ØµÙŠØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©</p>
            </div>
            
            <div class="game-info">
                <h3 style="color: #FFD700; margin-bottom: 15px;">ğŸ¯ ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨</h3>
                <div class="controls-guide">
                    <div class="control-item">
                        <span class="control-key">â† â†’</span>
                        <span>Ù„Ù„Ø­Ø±ÙƒØ© ÙŠÙ…ÙŠÙ† ÙˆÙŠØ³Ø§Ø±</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">SPACE</span>
                        <span>Ø£Ùˆ Ø²Ø± Ø§Ù„Ù‚ÙØ²</span>
                    </div>
                    <div class="control-item">
                        <span class="control-key">ğŸŸ¡</span>
                        <span>Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©</span>
                    </div>
                </div>
            </div>
            
            <div class="buttons">
                <button id="start-game-btn" class="game-btn">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
                <button id="help-btn" class="game-btn">â“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
            </div>
            
            <p style="margin-top: 20px; color: #aaa; font-size: 0.9rem;">
                Ø§Ø¶ØºØ· Ø²Ø± â›¶ Ù„Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø©
            </p>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <div class="stats">
                    <div class="stat-item">â± <span id="time-display">02:00</span></div>
                    <div class="stat-item">â­ <span id="score-display">0</span></div>
                    <div class="stat-item">â¤ï¸ <span id="lives-display">3</span></div>
                    <div class="stat-item">ğŸ¯ <span id="level-display">1</span></div>
                </div>
                <button id="pause-game-btn" class="game-btn" style="padding: 8px 15px; font-size: 1rem;">â¸</button>
            </div>
            
            <div class="game-area">
                <canvas id="game-canvas"></canvas>
                
                <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ -->
                <div class="touch-controls">
                    <div class="dpad">
                        <div class="dpad-row">
                            <button id="up-touch-btn" class="touch-btn">â†‘</button>
                        </div>
                        <div class="dpad-row">
                            <button id="left-touch-btn" class="touch-btn">â†</button>
                            <button id="right-touch-btn" class="touch-btn">â†’</button>
                        </div>
                    </div>
                    
                    <div>
                        <button id="jump-touch-btn" class="touch-btn">Ù‚ÙØ²</button>
                    </div>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress-fill"></div>
                </div>
            </div>
        </div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
        <div id="end-screen" class="screen">
            <div class="end-box">
                <div id="end-result-icon" class="end-icon">ğŸ†</div>
                <h2 id="end-title" style="color: #FFD700;">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h2>
                <p id="end-message" style="margin: 10px 0;">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p>
                
                <div class="end-stats">
                    <div class="end-stat">
                        <span>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</span>
                        <span id="final-score" style="color: #2ecc71;">0</span>
                    </div>
                    <div class="end-stat">
                        <span>Ø§Ù„Ø¹Ù…Ù„Ø§Øª:</span>
                        <span id="final-coins" style="color: #FFD700;">0/10</span>
                    </div>
                    <div class="end-stat">
                        <span>Ø§Ù„ÙˆÙ‚Øª:</span>
                        <span id="final-time" style="color: #3498db;">00:00</span>
                    </div>
                </div>
                
                <div class="buttons">
                    <button id="play-again-btn" class="game-btn" style="background: linear-gradient(135deg, #2ecc71, #27ae60);">ğŸ”„ Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</button>
                    <button id="back-to-menu-btn" class="game-btn">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”¥ SCRIPT Ø§Ù„ÙƒØ§Ù…Ù„ -->
    <script>
        // ============================================
        // ğŸ® GAME ENGINE - Ø¥ØµØ¯Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠ ÙŠØ¹Ù…Ù„ 100%
        // ============================================
        
        console.log('ğŸ® Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù„Ø¹Ø¨Ø© Ù…Ø§Ø±ÙŠÙˆ...');
        
        class MarioGame {
            constructor() {
                // ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ±
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                
                // ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø­Ø¬Ù… Ø§Ù„ÙƒÙ†ÙØ§Ø³
                this.setupCanvas();
                
                // Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                this.gameState = 'start'; // start, playing, paused, ended
                this.keys = {};
                this.touchControls = {
                    left: false,
                    right: false,
                    up: false,
                    jump: false
                };
                
                // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                this.score = 0;
                this.highScore = localStorage.getItem('marioHighScore') || 0;
                this.lives = 3;
                this.timeLeft = 120; // 2 Ø¯Ù‚ÙŠÙ‚Ø©
                this.coins = 0;
                this.totalCoins = 10;
                this.level = 1;
                
                // Ù…Ø¤Ù‚ØªØ§Øª
                this.gameTimer = null;
                this.lastTime = 0;
                this.deltaTime = 0;
                
                // Ø§Ù„Ø¹Ù†Ø§ØµØ±
                this.player = null;
                this.platforms = [];
                this.coinItems = [];
                this.enemies = [];
                this.createGameWorld();
                
                // ğŸ”¥ Ø§Ù„ØªØ­ÙƒÙ…
                this.setupControls();
                this.setupButtons();
                
                // ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                this.loadPlayerImage();
                
                console.log('âœ… Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ù‡ÙŠØ£Ø©');
            }
            
            // ğŸ”¥ Ø¥ØµÙ„Ø§Ø­: Ø­Ø¬Ù… Ø§Ù„ÙƒÙ†ÙØ§Ø³ ÙŠÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø©
            setupCanvas() {
                const updateSize = () => {
                    const container = document.querySelector('.game-area');
                    if (container) {
                        this.canvas.width = container.clientWidth;
                        this.canvas.height = container.clientHeight;
                    } else {
                        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø­Ø§ÙˆÙŠØ©ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
                        this.canvas.width = window.innerWidth;
                        this.canvas.height = window.innerHeight - 100; // Ø§ØªØ±Ùƒ Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø±
                    }
                    console.log(`ğŸ“ Ø­Ø¬Ù… Ø§Ù„ÙƒÙ†ÙØ§Ø³: ${this.canvas.width}x${this.canvas.height}`);
                };
                
                updateSize();
                window.addEventListener('resize', updateSize);
                window.addEventListener('orientationchange', () => {
                    setTimeout(updateSize, 100);
                });
            }
            
            loadPlayerImage() {
                const playerImg = document.getElementById('player-img');
                const img = new Image();
                
                // ğŸ”¥ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Ø¹Ø¯Ø© Ù…ØµØ§Ø¯Ø±
                const sources = [
                    'assets/player.png',
                    'assets/character.png',
                    'assets/mario.png',
                    'player.png',
                    'character.png'
                ];
                
                let currentSrc = 0;
                
                img.onload = function() {
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨');
                    playerImg.src = this.src;
                    playerImg.style.display = 'block';
                };
                
                img.onerror = function() {
                    console.log(`âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„: ${sources[currentSrc]}`);
                    currentSrc++;
                    
                    if (currentSrc < sources.length) {
                        img.src = sources[currentSrc];
                    } else {
                        console.log('âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø³Ù… Ø¨Ø¯ÙŠÙ„ Ù„Ù„Ø§Ø¹Ø¨');
                        playerImg.parentElement.innerHTML = '<div style="width:80px;height:120px;background:#E74C3C;border-radius:10px;"></div>';
                    }
                };
                
                img.src = sources[currentSrc];
            }
            
            createGameWorld() {
                // ğŸ”¥ Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.player = {
                    x: 100,
                    y: 300,
                    width: 40,
                    height: 60,
                    speed: 5,
                    velX: 0,
                    velY: 0,
                    jumpForce: -15,
                    grounded: false,
                    facingRight: true,
                    canJump: true
                };
                
                // ğŸ”¥ Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„Ù…Ù†ØµØ§Øª
                this.platforms = [
                    // Ø§Ù„Ø£Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    { x: 0, y: this.canvas.height - 50, width: this.canvas.width * 3, height: 50 }
                ];
                
                // Ù…Ù†ØµØ§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
                for (let i = 0; i < 8; i++) {
                    this.platforms.push({
                        x: 200 + i * 200,
                        y: 300 + Math.sin(i) * 80,
                        width: 150,
                        height: 20
                    });
                }
                
                // ğŸ”¥ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                this.coinItems = [];
                for (let i = 0; i < this.totalCoins; i++) {
                    this.coinItems.push({
                        x: 150 + i * 150,
                        y: 200 + Math.sin(i * 0.7) * 100,
                        collected: false,
                        anim: 0
                    });
                }
                
                // ğŸ”¥ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
                this.enemies = [
                    { x: 400, y: this.platforms[0].y - 40, width: 40, height: 40, dir: 1, speed: 2 },
                    { x: 700, y: this.platforms[0].y - 40, width: 40, height: 40, dir: -1, speed: 2.5 },
                    { x: 1000, y: this.platforms[2].y - 40, width: 40, height: 40, dir: 1, speed: 3 }
                ];
            }
            
            // ğŸ”¥ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³
            setupControls() {
                // Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
                window.addEventListener('keydown', (e) => {
                    this.keys[e.key.toLowerCase()] = true;
                    
                    // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¨Ø§Ù„Ù…ÙØ§ØªÙŠØ­
                    if ([' ', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                        e.preventDefault();
                    }
                    
                    // Ø§Ù„Ù‚ÙØ²
                    if (e.key === ' ' && this.player.canJump && this.player.grounded && this.gameState === 'playing') {
                        this.jump();
                    }
                });
                
                window.addEventListener('keyup', (e) => {
                    this.keys[e.key.toLowerCase()] = false;
                });
                
                // ğŸ”¥ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù„Ù…Ø³
                const setupTouchButton = (id, control) => {
                    const btn = document.getElementById(id);
                    if (!btn) return;
                    
                    const handleStart = (e) => {
                        e.preventDefault();
                        this.touchControls[control] = true;
                        
                        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø²Ø± Ø§Ù„Ù‚ÙØ²
                        if (control === 'jump' && this.player.canJump && this.player.grounded && this.gameState === 'playing') {
                            this.jump();
                        }
                    };
                    
                    const handleEnd = (e) => {
                        e.preventDefault();
                        this.touchControls[control] = false;
                    };
                    
                    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„Ù…Ø³
                    btn.addEventListener('touchstart', handleStart);
                    btn.addEventListener('touchend', handleEnd);
                    btn.addEventListener('touchcancel', handleEnd);
                    
                    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø§ÙˆØ³ (Ù„Ù„ØªØ·ÙˆÙŠØ±)
                    btn.addEventListener('mousedown', handleStart);
                    btn.addEventListener('mouseup', handleEnd);
                    btn.addEventListener('mouseleave', handleEnd);
                };
                
                setupTouchButton('left-touch-btn', 'left');
                setupTouchButton('right-touch-btn', 'right');
                setupTouchButton('up-touch-btn', 'up');
                setupTouchButton('jump-touch-btn', 'jump');
                
                console.log('âœ… Ø§Ù„ØªØ­ÙƒÙ… Ø¬Ø§Ù‡Ø²');
            }
            
            setupButtons() {
                // ğŸ”¥ Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡
                document.getElementById('start-game-btn').addEventListener('click', () => {
                    this.startGame();
                });
                
                // ğŸ”¥ Ø²Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
                document.getElementById('pause-game-btn').addEventListener('click', () => {
                    if (this.gameState === 'playing') {
                        this.pauseGame();
                    } else if (this.gameState === 'paused') {
                        this.resumeGame();
                    }
                });
                
                // ğŸ”¥ Ø²Ø± Ø§Ù„Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹
                document.getElementById('play-again-btn').addEventListener('click', () => {
                    this.startGame();
                });
                
                // ğŸ”¥ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                document.getElementById('back-to-menu-btn').addEventListener('click', () => {
                    this.showScreen('start');
                });
                
                // ğŸ”¥ Ø²Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
                document.getElementById('help-btn').addEventListener('click', () => {
                    alert(`ğŸ® Ù„Ø¹Ø¨Ø© Ù…Ø§Ø±ÙŠÙˆ\n\nğŸ¯ Ø§Ù„Ù‡Ø¯Ù:\nØ§Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© ğŸŸ¡\nØªØ¬Ù†Ø¨ Ø§Ù„Ø³Ù‚ÙˆØ· Ù…Ù† Ø§Ù„Ù…Ù†ØµØ§Øª âš ï¸\n\nğŸ® Ø§Ù„ØªØ­ÙƒÙ…:\n- Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø£Ø³Ù‡Ù… Ù„Ù„Ø­Ø±ÙƒØ©\n- SPACE Ù„Ù„Ù‚ÙØ²\n- Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø±\n\nâ± Ø§Ù„ÙˆÙ‚Øª: 2 Ø¯Ù‚ÙŠÙ‚Ø©\nâ¤ï¸ Ø§Ù„Ø£Ø±ÙˆØ§Ø­: 3`);
                });
                
                // ğŸ”¥ Ø²Ø± Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
                document.getElementById('fullscreen-btn').addEventListener('click', () => {
                    this.toggleFullscreen();
                });
                
                console.log('âœ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¬Ø§Ù‡Ø²Ø©');
            }
            
            jump() {
                if (this.player.grounded && this.gameState === 'playing') {
                    this.player.velY = this.player.jumpForce;
                    this.player.grounded = false;
                    this.player.canJump = false;
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù‚ÙØ² Ø¨Ø¹Ø¯ 0.3 Ø«Ø§Ù†ÙŠØ©
                    setTimeout(() => {
                        this.player.canJump = true;
                    }, 300);
                }
            }
            
            startGame() {
                console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©');
                
                // ğŸ”¥ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ Ø´ÙŠØ¡
                this.gameState = 'playing';
                this.score = 0;
                this.lives = 3;
                this.timeLeft = 120;
                this.coins = 0;
                this.level = 1;
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.player.x = 100;
                this.player.y = 300;
                this.player.velX = 0;
                this.player.velY = 0;
                this.player.grounded = false;
                this.player.canJump = true;
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù„Ù…
                this.createGameWorld();
                
                // ğŸ”¥ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                this.updateUI();
                this.updateProgress();
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨
                this.showScreen('game');
                
                // ğŸ”¥ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
                this.startTimer();
                
                // ğŸ”¥ Ø¨Ø¯Ø¡ Ø§Ù„Ø­Ù„Ù‚Ø©
                this.lastTime = performance.now();
                this.gameLoop();
                
                console.log('âœ… Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø¯Ø£Øª');
            }
            
            pauseGame() {
                if (this.gameState !== 'playing') return;
                
                this.gameState = 'paused';
                clearInterval(this.gameTimer);
                document.getElementById('pause-game-btn').textContent = 'â–¶';
                
                console.log('â¸ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…ØªÙˆÙ‚ÙØ©');
            }
            
            resumeGame() {
                if (this.gameState !== 'paused') return;
                
                this.gameState = 'playing';
                this.startTimer();
                document.getElementById('pause-game-btn').textContent = 'â¸';
                this.lastTime = performance.now();
                this.gameLoop();
                
                console.log('â–¶ Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ù„Ø¹Ø¨Ø©');
            }
            
            showScreen(screenName) {
                // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                document.getElementById(`${screenName}-screen`).classList.add('active');
            }
            
            startTimer() {
                clearInterval(this.gameTimer);
                
                this.gameTimer = setInterval(() => {
                    if (this.gameState === 'playing') {
                        this.timeLeft--;
                        this.updateUI();
                        
                        // ğŸ”¥ ÙØ­Øµ Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª
                        if (this.timeLeft <= 0) {
                            this.endGame(false); // Ø®Ø³Ø± Ø¨Ø§Ù„ÙˆÙ‚Øª
                        }
                    }
                }, 1000);
            }
            
            updatePlayer(deltaTime) {
                if (this.gameState !== 'playing') return;
                
                // ğŸ”¥ Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙˆØ§Ù„Ù„Ù…Ø³
                this.player.velX = 0;
                
                if (this.keys['arrowleft'] || this.keys['a'] || this.touchControls.left) {
                    this.player.velX = -this.player.speed;
                    this.player.facingRight = false;
                }
                
                if (this.keys['arrowright'] || this.keys['d'] || this.touchControls.right) {
                    this.player.velX = this.player.speed;
                    this.player.facingRight = true;
                }
                
                // ğŸ”¥ Ø§Ù„Ù‚ÙØ² Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙˆØ§Ù„Ù„Ù…Ø³
                if ((this.keys[' '] || this.keys['arrowup'] || this.keys['w'] || this.touchControls.up || this.touchControls.jump) 
                    && this.player.canJump && this.player.grounded) {
                    this.jump();
                }
                
                // ğŸ”¥ Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©
                this.player.velY += 0.8;
                if (this.player.velY > 20) this.player.velY = 20;
                
                // ğŸ”¥ Ø§Ù„Ø­Ø±ÙƒØ© Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„ÙˆÙ‚Øª
                this.player.x += this.player.velX * deltaTime * 60;
                this.player.y += this.player.velY * deltaTime * 60;
                
                // ğŸ”¥ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¹Ø§Ù„Ù… (ÙŠØ³Ø§Ø± ÙÙ‚Ø·)
                if (this.player.x < 0) {
                    this.player.x = 0;
                }
                
                // ğŸ”¥ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¹Ø§Ù„Ù… (ÙŠÙ…ÙŠÙ† - Ø¹Ø§Ù„Ù… ÙƒØ¨ÙŠØ±)
                const worldWidth = this.canvas.width * 3;
                if (this.player.x > worldWidth - this.player.width) {
                    this.player.x = worldWidth - this.player.width;
                }
                
                // ğŸ”¥ ÙØ­Øµ Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ù…Ø¹ Ø§Ù„Ù…Ù†ØµØ§Øª
                this.player.grounded = false;
                
                for (const platform of this.platforms) {
                    // Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰
                    if (this.player.x < platform.x + platform.width &&
                        this.player.x + this.player.width > platform.x &&
                        this.player.y + this.player.height > platform.y &&
                        this.player.y + this.player.height < platform.y + platform.height + this.player.velY &&
                        this.player.velY > 0) {
                        
                        this.player.y = platform.y - this.player.height;
                        this.player.velY = 0;
                        this.player.grounded = true;
                    }
                }
                
                // ğŸ”¥ ÙØ­Øµ Ø§Ù„Ø³Ù‚ÙˆØ·
                if (this.player.y > this.canvas.height + 100) {
                    this.lives--;
                    this.updateUI();
                    
                    if (this.lives <= 0) {
                        this.endGame(false); // Ø®Ø³Ø± Ø¨Ø§Ù„Ø£Ø±ÙˆØ§Ø­
                    } else {
                        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨
                        this.player.x = 100;
                        this.player.y = 300;
                        this.player.velY = 0;
                        this.player.grounded = false;
                    }
                }
            }
            
            updateEnemies(deltaTime) {
                for (let enemy of this.enemies) {
                    // Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
                    enemy.x += enemy.speed * enemy.dir * deltaTime * 60;
                    
                    // ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙˆØ§Ù
                    if (enemy.x < 0 || enemy.x + enemy.width > this.canvas.width * 3) {
                        enemy.dir *= -1;
                    }
                    
                    // Ø¬Ø¹Ù„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶
                    enemy.y = this.platforms[0].y - enemy.height;
                    
                    // ğŸ”¥ ÙØ­Øµ Ø§Ù„Ø§ØµØ·Ø¯Ø§Ù… Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
                    if (this.player.x < enemy.x + enemy.width &&
                        this.player.x + this.player.width > enemy.x &&
                        this.player.y < enemy.y + enemy.height &&
                        this.player.y + this.player.height > enemy.y) {
                        
                        // Ø¥Ø°Ø§ ÙˆØ·Ø£ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ùˆ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰
                        if (this.player.velY > 0 && this.player.y + this.player.height < enemy.y + enemy.height/2) {
                            // ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¹Ø¯Ùˆ
                            enemy.x = -1000; // Ø¥Ø²Ø§Ù„ØªÙ‡ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
                            this.score += 100;
                            this.updateUI();
                        } else {
                            // ØªØ¶Ø±Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨
                            this.lives--;
                            this.updateUI();
                            
                            if (this.lives <= 0) {
                                this.endGame(false);
                            } else {
                                // Ø§Ø±ØªØ¯Ø§Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±Ø±
                                this.player.velY = -10;
                                this.player.velX = this.player.facingRight ? -10 : 10;
                            }
                        }
                    }
                }
            }
            
            updateCoins(deltaTime) {
                for (let coin of this.coinItems) {
                    if (!coin.collected) {
                        // Ø­Ø±ÙƒØ© Ø·ÙÙŠÙØ© Ù„Ù„Ø¹Ù…Ù„Ø§Øª
                        coin.anim += deltaTime * 5;
                        
                        // ğŸ”¥ ÙØ­Øµ Ø§Ù„Ø¬Ù…Ø¹
                        const dx = this.player.x + this.player.width/2 - coin.x;
                        const dy = this.player.y + this.player.height/2 - coin.y;
                        const distance = Math.sqrt(dx*dx + dy*dy);
                        
                        if (distance < 30) {
                            coin.collected = true;
                            this.coins++;
                            this.score += 50;
                            this.updateUI();
                            this.updateProgress();
                            
                            // ğŸ”¥ ÙØ­Øµ Ø¥Ø°Ø§ Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                            if (this.coins >= this.totalCoins) {
                                this.endGame(true); // ÙÙˆØ²!
                            }
                        }
                    }
                }
            }
            
            gameLoop(currentTime = 0) {
                if (this.gameState !== 'playing') return;
                
                // ğŸ”¥ Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ
                this.deltaTime = (currentTime - this.lastTime) / 1000;
                this.lastTime = currentTime;
                
                // ğŸ”¥ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                this.updatePlayer(this.deltaTime);
                this.updateEnemies(this.deltaTime);
                this.updateCoins(this.deltaTime);
                
                // ğŸ”¥ Ø§Ù„Ø±Ø³Ù…
                this.draw();
                
                // ğŸ”¥ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø­Ù„Ù‚Ø©
                requestAnimationFrame((time) => this.gameLoop(time));
            }
            
            draw() {
                // ğŸ”¥ Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø©
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ğŸ”¥ Ø§Ù„Ø®Ù„ÙÙŠØ©
                const gradient = this.ctx.createLinearGradient(0, 0, 0, this.canvas.height);
                gradient.addColorStop(0, '#1a5276');
                gradient.addColorStop(0.5, '#3498db');
                gradient.addColorStop(1, '#87CEEB');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ğŸ”¥ Ø§Ù„Ø³Ø­Ø¨
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                for (let i = 0; i < 3; i++) {
                    const x = (Date.now() * 0.01 + i * 200) % (this.canvas.width + 200);
                    this.ctx.beginPath();
                    this.ctx.arc(x, 50, 30, 0, Math.PI * 2);
                    this.ctx.arc(x + 40, 50, 40, 0, Math.PI * 2);
                    this.ctx.arc(x + 90, 50, 30, 0, Math.PI * 2);
                    this.ctx.fill();
                }
                
                // ğŸ”¥ Ø§Ù„Ø£Ø±Ø¶ ÙˆØ§Ù„Ù…Ù†ØµØ§Øª
                this.platforms.forEach(platform => {
                    // Ø§Ù„Ø£Ø±Ø¶
                    this.ctx.fillStyle = '#8B4513';
                    this.ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                    
                    // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø±Ø¶
                    this.ctx.fillStyle = '#A0522D';
                    for (let i = 0; i < platform.width; i += 20) {
                        this.ctx.fillRect(platform.x + i, platform.y, 10, 5);
                    }
                    
                    // Ø¸Ù„
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                    this.ctx.fillRect(platform.x, platform.y + platform.height, platform.width, 5);
                });
                
                // ğŸ”¥ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
                this.coinItems.forEach(coin => {
                    if (!coin.collected) {
                        const bounce = Math.sin(coin.anim) * 10;
                        
                        // Ø¹Ù…Ù„Ø© Ø°Ù‡Ø¨ÙŠØ©
                        this.ctx.fillStyle = '#FFD700';
                        this.ctx.beginPath();
                        this.ctx.arc(coin.x, coin.y + bounce, 12, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        this.ctx.fillStyle = '#FFA500';
                        this.ctx.beginPath();
                        this.ctx.arc(coin.x, coin.y + bounce, 8, 0, Math.PI * 2);
                        this.ctx.fill();
                        
                        // Ø¨Ø±ÙŠÙ‚
                        this.ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                        this.ctx.beginPath();
                        this.ctx.arc(coin.x - 3, coin.y - 3 + bounce, 3, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                });
                
                // ğŸ”¥ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
                this.enemies.forEach(enemy => {
                    if (enemy.x < -100) return; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¯Ù…Ø±ÙŠÙ†
                    
                    // Ø¬Ø³Ù… Ø§Ù„Ø¹Ø¯Ùˆ
                    this.ctx.fillStyle = '#EF476F';
                    this.ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                    
                    // Ø¹ÙŠÙˆÙ†
                    this.ctx.fillStyle = '#2C3E50';
                    this.ctx.fillRect(enemy.x + 10, enemy.y + 10, 8, 8);
                    this.ctx.fillRect(enemy.x + enemy.width - 18, enemy.y + 10, 8, 8);
                    
                    // ÙÙ…
                    this.ctx.fillStyle = '#2C3E50';
                    this.ctx.fillRect(enemy.x + 15, enemy.y + 30, enemy.width - 30, 5);
                });
                
                // ğŸ”¥ Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.ctx.fillStyle = '#E74C3C';
                this.ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);
                
                // ÙˆØ¬Ù‡ Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.ctx.fillStyle = '#2C3E50';
                this.ctx.fillRect(this.player.x + 10, this.player.y + 10, 20, 20);
                
                // Ø¹ÙŠÙˆÙ† Ø§Ù„Ù„Ø§Ø¹Ø¨
                this.ctx.fillStyle = '#FFF';
                this.ctx.fillRect(this.player.x + 15, this.player.y + 15, 5, 5);
                this.ctx.fillRect(this.player.x + 25, this.player.y + 15, 5, 5);
                
                // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚ÙØ²
                if (!this.player.grounded) {
                    this.ctx.fillStyle = 'rgba(52, 152, 219, 0.3)';
                    this.ctx.beginPath();
                    this.ctx.arc(
                        this.player.x + this.player.width/2,
                        this.player.y + this.player.height,
                        15,
                        0,
                        Math.PI * 2
                    );
                    this.ctx.fill();
                }
                
                // ğŸ”¥ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                this.ctx.fillRect(10, 10, 200, 80);
                
                this.ctx.fillStyle = '#FFF';
                this.ctx.font = '12px Arial';
                this.ctx.fillText(`Ø§Ù„Ù…ÙˆÙ‚Ø¹: (${Math.floor(this.player.x)}, ${Math.floor(this.player.y)})`, 20, 30);
                this.ctx.fillText(`Ø§Ù„Ø­Ø§Ù„Ø©: ${this.gameState}`, 20, 50);
                this.ctx.fillText(`Ø¹Ù…Ù„Ø§Øª: ${this.coins}/${this.totalCoins}`, 20, 70);
                this.ctx.fillText(`Ø£Ø¹Ø¯Ø§Ø¡: ${this.enemies.length}`, 20, 90);
            }
            
            endGame(isWin) {
                console.log(isWin ? 'ğŸ† ÙÙˆØ²!' : 'ğŸ’€ Ø®Ø³Ø§Ø±Ø©!');
                
                this.gameState = 'ended';
                clearInterval(this.gameTimer);
                
                // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø£ÙØ¶Ù„ Ù†ØªÙŠØ¬Ø©
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    localStorage.setItem('marioHighScore', this.highScore);
                }
                
                // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
                document.getElementById('end-result-icon').textContent = isWin ? 'ğŸ†' : 'ğŸ’€';
                document.getElementById('end-title').textContent = isWin ? 'ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!' : 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©';
                document.getElementById('end-message').textContent = isWin 
                    ? `Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${this.level}!` 
                    : 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!';
                
                document.getElementById('final-score').textContent = this.score;
                document.getElementById('final-coins').textContent = `${this.coins}/${this.totalCoins}`;
                document.getElementById('final-time').textContent = this.formatTime(120 - this.timeLeft);
                
                this.showScreen('end');
            }
            
            updateUI() {
                document.getElementById('time-display').textContent = this.formatTime(this.timeLeft);
                document.getElementById('score-display').textContent = this.score;
                document.getElementById('lives-display').textContent = this.lives;
                document.getElementById('level-display').textContent = this.level;
            }
            
            updateProgress() {
                const progress = (this.coins / this.totalCoins) * 100;
                document.getElementById('progress-fill').style.width = `${progress}%`;
            }
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©: ${err.message}`);
                        alert('Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
                    });
                } else {
                    document.exitFullscreen();
                }
            }
        }
        
        // ============================================
        // ğŸ”¥ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        // ============================================
        
        let game;
        
        window.addEventListener('load', () => {
            console.log('ğŸ“„ Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù…Ù„Ø©');
            
            // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„
            const progressEl = document.getElementById('load-progress');
            if (progressEl) {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 10;
                    progressEl.textContent = `${progress}%`;
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        
                        // ğŸ”¥ Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                        setTimeout(() => {
                            const loadingScreen = document.getElementById('loading-screen');
                            loadingScreen.style.opacity = '0';
                            
                            setTimeout(() => {
                                loadingScreen.style.display = 'none';
                                document.getElementById('game-container').style.display = 'block';
                                
                                // ğŸ”¥ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
                                game = new MarioGame();
                                console.log('âœ… Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ø¨!');
                                
                                // ğŸ”¥ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
                                console.log('ğŸ® Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…:');
                                console.log('- Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­: Ø§Ù„Ø£Ø³Ù‡Ù… + SPACE');
                                console.log('- Ø§Ù„Ù‡Ø§ØªÙ: Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©');
                                console.log('- Ø²Ø± â›¶ Ù„Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©');
                            }, 500);
                        }, 500);
                    }
                }, 300);
            }
        });
        
        // ğŸ”¥ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ù„Ù„Ù‡Ø§ØªÙ
        function lockOrientation() {
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('landscape').catch(err => {
                    console.log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¯ÙˆØ±Ø§Ù†:', err);
                });
            }
        }
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        if (window.innerHeight > window.innerWidth) {
            setTimeout(lockOrientation, 1000);
        }
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø¬Ù…
        window.addEventListener('resize', () => {
            if (window.innerHeight > window.innerWidth) {
                lockOrientation();
            }
        });
        
        // ğŸ”¥ Ù…Ù†Ø¹ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        
        // Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¨Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        window.addEventListener('keydown', (e) => {
            if ([' ', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
            }
        });
        
        console.log('ğŸ® Ø´ØºÙ‘Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ø¶ØºØ· Ø²Ø± "ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨"!');
    </script>
</body>
</html>
